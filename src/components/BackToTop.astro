---
const label = "Back to top";
---

<button
  class="back-to-top focus-outline"
  data-back-to-top
  type="button"
  aria-label={label}
  aria-hidden="true"
  tabindex="-1"
>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
    <path
      d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"
    ></path>
  </svg>
  <span class="sr-only">{label}</span>
</button>

<style>
  .back-to-top {
    @apply fixed bottom-5 right-4 z-20 flex h-12 w-12 translate-y-3 items-center justify-center rounded-full border border-skin-line bg-skin-card text-skin-base opacity-0 shadow-lg transition-all duration-200 ease-out hover:bg-skin-card-muted;
    pointer-events: none;
  }
  .back-to-top svg {
    @apply h-5 w-5 rotate-90 fill-skin-base;
  }
  .back-to-top--visible {
    @apply translate-y-0 opacity-90;
    pointer-events: auto;
  }
</style>

<script is:inline>
  (() => {
    let cleanup = () => {};

    const toggleVisibility = button => {
      const shouldShow = window.scrollY > 240;
      button.classList.toggle("back-to-top--visible", shouldShow);
      button.setAttribute("aria-hidden", shouldShow ? "false" : "true");
      button.tabIndex = shouldShow ? 0 : -1;
    };

    const init = () => {
      cleanup();

      const button = document.querySelector("[data-back-to-top]");
      if (!button) return;

      const scrollToTop = () => window.scrollTo({ top: 0, behavior: "smooth" });
      const handleScroll = () => toggleVisibility(button);

      button.addEventListener("click", scrollToTop);
      window.addEventListener("scroll", handleScroll, { passive: true });
      toggleVisibility(button);

      cleanup = () => {
        button.removeEventListener("click", scrollToTop);
        window.removeEventListener("scroll", handleScroll);
      };
    };

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init, { once: true });
    } else {
      init();
    }

    document.addEventListener("astro:after-swap", init);
  })();
</script>
